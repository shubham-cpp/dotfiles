# vim:fileencoding=utf-8:ft=conf
# Minimal kitty.conf - only TRUE modifications from kitty defaults

# === Font ===
font_family FiraCode Nerd Font
font_size 11.5

# === Theme ===
include tokyo_night.conf

# === Appearance ===
background_opacity 0.90
cursor #05a3ff
cursor_blink_interval 0

# === Tab bar ===
tab_bar_style powerline
tab_powerline_style slanted
tab_separator " ┇"
tab_title_template "{index}: {tab.active_oldest_wd.split('/')[-1]}"

# === Bell ===
enable_audio_bell no

# === Shell ===
shell /bin/fish -l

# === Remote control ===
allow_remote_control yes

# === macOS ===
macos_option_as_alt yes

# === Other ===
update_check_interval 0
wayland_enable_ime no

# === Marks ===
mark1_foreground black
mark1_background #98d3cb
mark2_foreground black
mark2_background #f2dcd3
mark3_foreground black
mark3_background #f274bc

# ═══════════════════════════════════════════════════════════════════════════════
# KEYBINDINGS - Ergonomic, vim-like design with kitty_mod (Ctrl+Shift) as prefix
# ═══════════════════════════════════════════════════════════════════════════════
# Design Philosophy:
#   Alt      = Tab navigation (lightweight, frequently used)
#   kitty_mod = Window/Pane management (Ctrl+Shift)
#   Shift+kitty_mod = Destructive operations (close, move)
#   h/j/k/l   = Vim-style directional navigation
#   [ ] { }   = Bracket pairs for prev/next and move operations
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# TAB MANAGEMENT (Alt prefix - lightweight)
# ───────────────────────────────────────────────────────────────────────────────
# Alt + number = jump to tab
map alt+1 goto_tab 1
map alt+2 goto_tab 2
map alt+3 goto_tab 3
map alt+4 goto_tab 4
map alt+5 goto_tab 5
map alt+6 goto_tab 6
map alt+7 goto_tab 7
map alt+8 goto_tab 8
map alt+9 goto_tab 9

# Tab cycling (vim-like brackets: [ = previous, ] = next)
map alt+[ previous_tab
map alt+] next_tab
# map kitty_mod+p previous_tab
# map kitty_mod+n next_tab

# Tab movement (shift + brackets: { = move left, } = move right)
map shift+alt+[ move_tab_backward
map shift+alt+] move_tab_forward

# Tab operations (t = tab, q = quit, r = rename)
map alt+t new_tab_with_cwd
map shift+alt+x close_tab
map alt+r set_tab_title

# Tab navigation helpers (g = go/select, o = other/last focused)
map alt+o nth_window -1
map alt+g select_tab

# ───────────────────────────────────────────────────────────────────────────────
# WINDOW/PANE CREATION (kitty_mod prefix)
# ───────────────────────────────────────────────────────────────────────────────
# Split windows (s = horizontal split/top-bottom, v = vertical split/left-right)
# Note: hsplit = horizontal divider (top/bottom panes)
#       vsplit = vertical divider (left/right panes)
map alt+s launch --cwd=current --location=hsplit
map alt+v launch --cwd=current --location=vsplit

# New window (enter = "enter" a new window)
map kitty_mod+enter launch --cwd=current
map kitty_mod+n new_os_window

# ───────────────────────────────────────────────────────────────────────────────
# PANE/WINDOW NAVIGATION (vim-style h/j/k/l)
# ───────────────────────────────────────────────────────────────────────────────
# Navigate between panes (h=left, j=down, k=up, l=right)
map alt+h neighboring_window left
map alt+j neighboring_window down
map alt+k neighboring_window up
map alt+l neighboring_window right

# ───────────────────────────────────────────────────────────────────────────────
# PANE/WINDOW MOVEMENT (shift + vim keys)
# ───────────────────────────────────────────────────────────────────────────────
# Move panes in direction
# map kitty_mod+alt+h move_window left
# map kitty_mod+alt+j move_window down
# map kitty_mod+alt+k move_window up
# map kitty_mod+alt+l move_window right

# Swap with adjacent (f = forward, b = backward)
map kitty_mod+f move_window_forward
map kitty_mod+b move_window_backward

# ───────────────────────────────────────────────────────────────────────────────
# PANE RESIZING - Single Key Actions (kitty_mod + alt)
# ───────────────────────────────────────────────────────────────────────────────
# Resize using directional keys
map shift+alt+h resize_window wider
map shift+alt+j resize_window shorter
map shift+alt+k resize_window taller
map shift+alt+l resize_window narrower
map shift+alt+r resize_window reset

# ───────────────────────────────────────────────────────────────────────────────
# PANE RESIZING - Interactive Mode (vim-like modal editing)
# ───────────────────────────────────────────────────────────────────────────────
# Press kitty_mod+R to enter mode, then h/j/k/l to resize, esc/q to exit
map --new-mode resize kitty_mod+R
map --mode resize h resize_window narrower 2
map --mode resize j resize_window shorter 2
map --mode resize k resize_window taller 2
map --mode resize l resize_window wider 2
map --mode resize H resize_window narrower 5
map --mode resize J resize_window shorter 5
map --mode resize K resize_window taller 5
map --mode resize L resize_window wider 5
map --mode resize r resize_window reset
map --mode resize esc pop_keyboard_mode
map --mode resize q pop_keyboard_mode

# ───────────────────────────────────────────────────────────────────────────────
# PANE/WINDOW MANAGEMENT
# ───────────────────────────────────────────────────────────────────────────────
# Close windows (w = close window, W = close other windows)
map kitty_mod+w close_window
map alt+shift+c close_window
map kitty_mod+alt+w close_other_windows_in_tab

# Window selection (0 = last focused, p = pick window visually)
map alt+0 nth_window -1

# Quick window access by number (1-9 = jump to nth window)
map kitty_mod+1 first_window
map kitty_mod+2 second_window
map kitty_mod+3 third_window
map kitty_mod+4 fourth_window
map kitty_mod+5 fifth_window
map kitty_mod+6 sixth_window
map kitty_mod+7 seventh_window
map kitty_mod+8 eighth_window
map kitty_mod+9 ninth_window

# ───────────────────────────────────────────────────────────────────────────────
# LAYOUT MANAGEMENT
# ───────────────────────────────────────────────────────────────────────────────
# Cycle layouts (ctrl+shift+space)
enabled_layouts splits,fat,stack,tall,grid
map kitty_mod+space next_layout

# Jump to specific layouts
map kitty_mod+! goto_layout splits
map kitty_mod+@ goto_layout fat
map kitty_mod+# goto_layout tall
map kitty_mod+$ goto_layout stack
map kitty_mod+% goto_layout grid

# Quick zoom toggle (z = zoom via stack layout)
map alt+z toggle_layout stack
# map f11 toggle_layout stack

# ───────────────────────────────────────────────────────────────────────────────
# SCROLLING
# ───────────────────────────────────────────────────────────────────────────────
map kitty_mod+home      scroll_home
map kitty_mod+end       scroll_end
map kitty_mod+page_up   scroll_page_up
map kitty_mod+page_down scroll_page_down
map kitty_mod+up        scroll_line_up
map kitty_mod+down      scroll_line_down

# ───────────────────────────────────────────────────────────────────────────────
# COPY MODE ALTERNATIVES (kitty doesn't have traditional copy mode)
# ───────────────────────────────────────────────────────────────────────────────
# kitten hints - the kitty way to select and interact with text
map kitty_mod+e>o kitten hints
map kitty_mod+e>y kitten hints --program @
map kitty_mod+e>p kitten hints --program -

# Path hints (p > f = path, shift+f = full path, l = line, w = word, h = hash, n = linenum)
map kitty_mod+p>f kitten hints --type path --program -
map kitty_mod+p>shift+f kitten hints --type path
map kitty_mod+p>l kitten hints --type line --program -
map kitty_mod+p>w kitten hints --type word --program -
map kitty_mod+p>h kitten hints --type hash --program -
map kitty_mod+p>n kitten hints --type linenum

# Fuzzy search through scrollback (interactive overlay)
map ctrl+alt+f launch --type=overlay --stdin-source=@screen_scrollback fzf --no-sort --no-mouse --exact -i
map ctrl+alt+g kitten hints --type=linenum --linenum-action=tab nvim +{line} {path}

# ───────────────────────────────────────────────────────────────────────────────
# FONT SIZE
# ───────────────────────────────────────────────────────────────────────────────
map kitty_mod+equal     change_font_size all +2.0
map kitty_mod+minus     change_font_size all -2.0
map kitty_mod+backspace change_font_size all 0

# ───────────────────────────────────────────────────────────────────────────────
# BACKGROUND OPACITY
# ───────────────────────────────────────────────────────────────────────────────
map kitty_mod+a>m set_background_opacity +0.1
map kitty_mod+a>l set_background_opacity -0.1
map kitty_mod+a>1 set_background_opacity 1
map kitty_mod+a>d set_background_opacity default

# ───────────────────────────────────────────────────────────────────────────────
# CLIPBOARD
# ───────────────────────────────────────────────────────────────────────────────
map kitty_mod+c copy_to_clipboard
map kitty_mod+v paste_from_clipboard
map kitty_mod+o  pass_selection_to_program
map shift+insert paste_from_selection

# ───────────────────────────────────────────────────────────────────────────────
# MISCELLANEOUS
# ───────────────────────────────────────────────────────────────────────────────
map kitty_mod+f11    toggle_fullscreen
map kitty_mod+f10    toggle_maximized
map kitty_mod+u      kitten unicode_input
map kitty_mod+i      edit_config_file
map kitty_mod+escape kitty_shell window
map kitty_mod+delete clear_terminal reset active

# ───────────────────────────────────────────────────────────────────────────────
# APPLICATION SPECIFIC
# ───────────────────────────────────────────────────────────────────────────────
map --when-focus-on title:claude shift+enter send_text normal,application \\\n

# ───────────────────────────────────────────────────────────────────────────────
# MOUSE
# ───────────────────────────────────────────────────────────────────────────────
mouse_map ctrl+alt+left press ungrabbed mouse_selection rectangle
mouse_map shift+left click grabbed,ungrabbed mouse_handle_click selection link

# nth_window - now alt+0
map kitty_mod+0 nth_window -1

# close_window - now shift+alt+c (already mapped above)
map kitty_mod+w close_window

# toggle_layout stack zoom - now alt+z
map kitty_mod+z toggle_layout stack
